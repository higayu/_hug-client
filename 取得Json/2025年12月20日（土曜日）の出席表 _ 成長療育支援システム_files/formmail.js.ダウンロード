/*
 calender
 -----------------------------------------------*/

// 使用するIDを選択
$(function () {
    datepickerElm("#dp1");
    datepickerElm("#dp2");
    datepickerElm("#dp3");
    datepickerElm("#dp4");
    datepickerElm("#dp5");
    datepickerElm("#dp6");
    //個別支援計画別表用のID
    $('html').find('[id*="other_table_dp"]').each(function () {
        const id = `#${$(this).attr('id')}`;
        datepickerElm(id);
    });
    datepickerElmNew(".newDatePickerJs");
});

function datepickerElm(id) {
    // datepickerの関数
    $(id).datepicker({
        showButtonPanel: true,
        beforeShow: function (input) {
            setTimeout(function () {
                var buttonPane = $(input)
                    .datepicker("widget")
                    .find(".ui-datepicker-buttonpane");

                var btn = $('<button class="ui-datepicker-current ui-state-default ui-priority-primary ui-corner-all" type="button">クリア</button>');
                btn
                    .unbind("click")
                    .bind("click", function () {
                        $.datepicker._clearDate(input);
                    });

                btn.appendTo(buttonPane);
            }, 1);
        },
        onChangeMonthYear: function (year, month, instance) {
            setTimeout(function () {
                var buttonPane = $(instance)
                    .datepicker("widget")
                    .find(".ui-datepicker-buttonpane");

                var btn = $('<button class="ui-datepicker-current ui-state-default ui-priority-primary ui-corner-all" type="button">クリア</button>');
                btn
                    .unbind("click")
                    .bind("click", function () {
                        $.datepicker._clearDate(instance.input);
                    });

                btn.appendTo(buttonPane);
            }, 1);
        }
    });

}
function datepickerElmNew(id) {
    $(id).datepicker({
        showButtonPanel: true,
        beforeShow: function (input) {
            setTimeout(function () {
                var buttonPane = $(input)
                    .datepicker("widget")
                    .find(".ui-datepicker-buttonpane");

                var btn = $('<button class="ui-datepicker-current ui-state-default ui-priority-primary ui-corner-all" type="button">クリア</button>');
                btn
                    .unbind("click")
                    .bind("click", function () {
                        $.datepicker._clearDate(input);
                    });

                btn.appendTo(buttonPane);
            }, 1);
        },
        onChangeMonthYear: function (year, month, instance) {
            setTimeout(function () {
                var buttonPane = $(instance)
                    .datepicker("widget")
                    .find(".ui-datepicker-buttonpane");

                var btn = $('<button class="ui-datepicker-current ui-state-default ui-priority-primary ui-corner-all" type="button">クリア</button>');
                btn
                    .unbind("click")
                    .bind("click", function () {
                        $.datepicker._clearDate(instance.input);
                    });

                btn.appendTo(buttonPane);
            }, 1);
        }
    });
}

//年月用
$(function () {
    var idList = ["#ymp1", "#ymp2", "#ymp3", "#ymp4", "#ymp5", "#ymp6"];
    for (var i = 0; i < idList.length; i++) {
        if ($(idList[i]).length > 0) {
            ympickerElm(idList[i]);
        }
    }
});
function ympickerElm(id) {
    // 当月ボタンが機能するための記述
    $.ympicker._gotoToday = function(id) {
        var target = $(id);
        var inst = this._getInst(target[0]);
        var date = new Date();
        this._setDate(inst,date);
        this._hideYmpicker();
    }
    // ここまで
    $(id).ympicker({
        showButtonPanel: true,
        currentText: '当月'

    });
}


/*
 当月のみ選択可能なcalender
 -----------------------------------------------*/

$(function () {

    // 表示変更の年月の値を取得
    var year = $("[name='s_year']").val();
    var month = $("[name='s_month']").val();

    // datepickerの呼び出し
    var dates = $('#period1, #period2').datepicker({
        showButtonPanel: true,
        dateFormat: 'yy/mm/dd',
        changeMonth: false,
        changeYear: false,
        beforeShow: function (input, inst) {
            setTimeout(function () {

                // datepickerの初期表示
                inst.drawYear = year;
                inst.drawMonth = month - 1;
                $.datepicker._updateDatepicker(inst);

                // クリアボタンの表示
                var buttonPane = $(input).datepicker("widget").find(".ui-datepicker-buttonpane");
                var btn = $('<button class="ui-datepicker-current ui-state-default ui-priority-primary ui-corner-all" type="button">クリア</button>');
                btn.unbind("click").bind("click", function () {
                    $.datepicker._clearDate(input);
                });
                btn.appendTo(buttonPane);

                // 先月・今月移動のボタンを消す
                $('.ui-datepicker-prev,.ui-datepicker-next').hide();
            }, 1);
        },
        // 終了日の日付を開始日より前に選択できなくする
        onSelect: function (selectedDate) {
            var option = this.id == 'period1' ? 'minDate' : 'maxDate',
                instance = $(this).data('datepicker'),
                date = $.datepicker.parseDate(
                    instance.settings.dateFormat ||
                    $.datepicker._defaults.dateFormat,
                    selectedDate, instance.settings);
            dates.not(this).datepicker('option', option, date);
        }
    });

});
